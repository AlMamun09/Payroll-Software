@model PayrollSoftware.Infrastructure.Application.DTOs.LookupDto
@{
  ViewData["Title"] = ViewBag?.Title ?? "Lookup";
  var formAction = ViewBag?.FormAction as string ?? Url.Action("Create", "Lookup");
  var isEdit = Model?.LookupId != Guid.Empty;
}

<div class="card">
  <div class="card-header">
    <h3 class="card-title m-0">
      <i class="fas fa-list mr-2"></i>@ViewData["Title"]
    </h3>
    <div class="card-tools d-none d-md-block">
      <a asp-action="Index" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to List
      </a>
    </div>
  </div>
  <div class="card-body">
    <form id="lookupForm" method="post" action="@formAction">
      @Html.AntiForgeryToken()
      <input type="hidden" asp-for="LookupId" />

      <div class="row">
        <div class="form-group col-md-4">
          <label asp-for="LookupType">Lookup Type <span class="text-danger">*</span></label>
          <select asp-for="LookupType" class="form-control select2" id="LookupType"
            data-placeholder="Select Lookup Type" style="width:100%;" required>
            <option value="">-- Select Type --</option>
            @if (ViewBag.LookupTypes != null)
            {
              foreach (var type in (List<string>)ViewBag.LookupTypes)
              {
                <option value="@type" selected="@(Model?.LookupType == type)">@type</option>
              }
            }
          </select>
          <span asp-validation-for="LookupType" class="text-danger"></span>
          <small class="form-text text-muted">Category of the lookup value</small>
        </div>

        <div class="form-group col-md-5">
          <label asp-for="LookupValue">Lookup Value <span class="text-danger">*</span></label>
          <input asp-for="LookupValue" class="form-control" placeholder="e.g., Male, Female, etc." required />
          <span asp-validation-for="LookupValue" class="text-danger"></span>
          <small class="form-text text-muted">The actual value to be displayed in dropdowns</small>
        </div>

        <div class="form-group col-md-3">
          <label asp-for="DisplayOrder">Display Order <span class="text-danger">*</span></label>
          <input asp-for="DisplayOrder" type="number" class="form-control" value="0" min="0" required />
          <span asp-validation-for="DisplayOrder" class="text-danger"></span>
          <small class="form-text text-muted">Order in which values appear</small>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="form-group">
            <div class="custom-control custom-switch">
              <input asp-for="IsActive" type="checkbox" class="custom-control-input" id="IsActiveSwitch" />
              <label class="custom-control-label" for="IsActiveSwitch">
                <strong>Active</strong>
                <small class="text-muted d-block">Only active lookups will appear in dropdowns</small>
              </label>
            </div>
          </div>
        </div>
      </div>

      <hr />

      <!-- Examples Section -->
      <div class="alert alert-info">
        <h5><i class="icon fas fa-info-circle"></i> Examples:</h5>
        <ul class="mb-0">
          <li><strong>Gender:</strong> Male, Female, Other</li>
          <li><strong>LeaveType:</strong> Casual, Sick, Earned, Unpaid</li>
          <li><strong>Status:</strong> Active, Resigned, Terminated</li>
          <li><strong>PaymentSystem:</strong> Bank Transfer, Mobile Banking, Cash Payment</li>
        </ul>
      </div>

      <div class="text-right">
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save mr-1"></i> @(isEdit ? "Update" : "Save")
        </button>
        <a class="btn btn-secondary" href="@Url.Action("Index", "Lookup")">
          <i class="fas fa-times mr-1"></i> Cancel
        </a>
      </div>
    </form>
  </div>
</div>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />

  <!-- Select2 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />

  <script>
    $(document).ready(function () {
      // Initialize Select2
      CommonAjax.initSelect2('.select2');

      // Form submission handler
      const form = document.getElementById('lookupForm');
      CommonAjax.submitForm(form, {
        successTitle: 'Success',
        successMessage: '@(isEdit ? "Lookup updated successfully!" : "Lookup created successfully!")',
        errorTitle: 'Validation Error',
        beforeSubmit: function () {
          // Trim input values
          const lookupValue = document.getElementById('LookupValue');
          if (lookupValue) {
            lookupValue.value = lookupValue.value.trim();
          }

          // Validate that value is not empty after trim
          if (!lookupValue.value) {
            Swal.fire({
              icon: 'error',
              title: 'Validation Error',
              text: 'Lookup Value cannot be empty',
              confirmButtonColor: CommonAjax.SWAL_CONFIG.confirmButtonColor
            });
            return false;
          }

          return true;
        },
        onSuccess: function (data) {
          window.location.href = '@Url.Action("Index", "Lookup")';
        }
      });

      // Prevent form submission on Enter key in input fields (except submit button)
      $('#lookupForm').on('keydown', 'input', function (e) {
        if (e.key === 'Enter' && e.target.type !== 'submit') {
          e.preventDefault();
        }
      });
    });
  </script>
}